/* ========================================
   【移动端优化】Mobile-First Enhancements
   ======================================== */

/* iOS安全区域适配 */
@media (max-width: 768px) {
    body {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
    }

    /* 优化移动端字体大小 */
    body { padding: 1rem !important; }
    .zone-title { font-size: 14px; }
    .zone-sub { font-size: 10px; }
    .room-title { font-size: 14px; }
    .room-owner { font-size: 12px; }

    /* 优化触摸目标大小(最小44x44px) */
    .action-btn { width: 44px; height: 44px; }
    button, .notify-btn, .auto-refresh-btn {
        min-height: 44px;
        padding: 10px 14px;
    }

    /* 优化卡片间距 */
    .zone-container { margin-bottom: 2rem; }
    .card-info { padding: 12px; }

    /* Toast移动端位置 */
    #toast-container {
        bottom: 1rem;
        right: 1rem;
        left: 1rem;
    }
    .toast {
        width: 100%;
        text-align: center;
    }

    /* 移除hover效果，优化触摸体验 */
    .room-card:hover {
        transform: none;
        box-shadow: 0 5px 8px -1px rgba(0,0,0,0.3);
    }
    .room-card:active {
        transform: scale(0.98);
    }
}

/* iPhone SE等小屏设备 */
@media (max-width: 375px) {
    .monitor-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
    .zone-header { gap: 8px; }
}

/* ========================================
   【移动端】头部工具栏优化
   ======================================== */
@media (max-width: 768px) {
    header {
        padding: 1rem !important;
        gap: 1rem !important;
        margin-bottom: 1.5rem !important;
        flex-direction: column !important;
    }

    header > div:first-child {
        border-right: none !important;
        padding: 0 !important;
        width: 100%;
        justify-content: center;
    }

    header h1 {
        font-size: 1.25rem !important; /* 20px */
        text-align: center;
    }

    header h1 span {
        display: block;
        font-size: 0.75rem !important; /* 12px */
        margin-top: 0.25rem;
        margin-left: 0 !important;
    }

    /* 输入区域 */
    header > div:nth-child(2) {
        flex-direction: column;
        gap: 0.5rem !important;
        padding: 0.75rem !important;
    }

    #custom-selector-container {
        width: 100% !important;
    }

    #room-id-input {
        width: 100%;
        padding: 0.75rem !important;
    }

    header button {
        width: 100%;
        justify-content: center;
    }

    /* 工具按钮区 */
    header > div:last-child {
        width: 100%;
        padding: 0 !important;
        justify-content: space-between;
        flex-wrap: wrap;
    }

    .auto-refresh-btn,
    .notify-btn,
    .keepalive-btn {
        flex: 1;
        min-width: 120px;
    }

    #global-refresh-btn {
        flex: 0 0 auto;
    }
}

/* ========================================
   【移动端】卡片和交互优化
   ======================================== */
@media (max-width: 768px) {
    /* 优化卡片内边距 */
    .u-avatar {
        width: 48px !important;
        height: 48px !important;
    }

    .viewer-pill {
        font-size: 11px !important;
        padding: 3px 8px !important;
    }

    /* 优化状态芯片 */
    .status-chip {
        font-size: 11px !important;
        padding: 4px 10px !important;
    }

    /* 优化卡片按钮 */
    .card-actions {
        opacity: 1 !important; /* 移动端始终显示 */
    }

    /* 优化下拉菜单 */
    #selector-menu {
        position: fixed !important;
        left: 0.5rem !important;
        right: 0.5rem !important;
        width: auto !important;
        max-width: none !important;
    }

    #history-dropdown {
        position: fixed !important;
        left: 0.5rem !important;
        right: 0.5rem !important;
        top: auto !important;
        bottom: 5rem !important;
    }

    /* 优化区域标题 */
    .zone-header {
        padding-left: 0.5rem !important;
    }

    /* 触摸滚动优化 */
    body {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
    }

    /* 防止iOS双击缩放 */
    * {
        touch-action: manipulation;
    }
}

/* ========================================
   【平板端】优化 - 舒适布局
   ======================================== */
@media (min-width: 768px) and (max-width: 1024px) {
    .monitor-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
    }

    header {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 1rem;
    }

    header h1 {
        font-size: 1.5rem;
    }

    /* 工具按钮区 - 允许换行 */
    header > div:last-child {
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .auto-refresh-btn,
    .notify-btn,
    .keepalive-btn {
        flex: 0 1 auto;
        min-width: 110px;
    }

    /* 卡片底栏 - 缩小字体和间距 */
    .viewer-pill {
        font-size: 11px !important;
        padding: 3px 8px !important;
        gap: 4px;
    }

    .live-duration {
        font-size: 11px !important;
        padding: 3px 7px !important;
    }
}

/* ========================================
   【桌面端】优化 - 原版舒适布局（5列）
   ======================================== */
@media (min-width: 1025px) {
    .monitor-grid {
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 1rem;
    }

    header {
        flex-direction: row;
        gap: 1.5rem;
    }

    header h1 {
        font-size: 2rem;
    }

    /* 桌面端允许雪花特效（由JS控制开关，移除!important让JS可以控制） */
    #snow-canvas {
        /* display由JS控制，不强制设置 */
    }
}

/* ========================================
   【中等桌面】优化 - 窗口宽度 1025px-1440px
   ======================================== */
@media (min-width: 1025px) and (max-width: 1440px) {
    /* 工具按钮区 - 允许换行防止溢出 */
    header > div:last-child {
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .auto-refresh-btn,
    .notify-btn,
    .keepalive-btn {
        flex: 0 1 auto;
        min-width: 100px;
        padding: 0.5rem 0.875rem;
        font-size: 0.875rem;
    }

    /* 卡片底栏 - 轻微缩小 */
    .viewer-pill {
        font-size: 11.5px !important;
        padding: 3.5px 9px !important;
    }

    .live-duration {
        font-size: 11.5px !important;
        padding: 3.5px 7.5px !important;
    }
}

/* ========================================
   【中窄桌面】按钮下沉到搜索栏下方
   ======================================== */
@media (min-width: 768px) and (max-width: 1200px) {
    header {
        flex-wrap: wrap;
        align-items: center;
        gap: 1rem;
    }

    header > div:first-child {
        order: 1;
        flex: 0 0 auto;
    }

    header > div:nth-child(2) {
        order: 2;
        flex: 1 1 520px;
        min-width: 360px;
    }

    header > div:last-child {
        order: 3;
        width: 100%;
        padding: 0;
        justify-content: flex-start;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
}

/* ========================================
   【窄卡片】优化 - 当卡片宽度 < 320px
   ======================================== */
@media (min-width: 768px) {
    /* 使用容器查询的备选方案：通过视口宽度估算卡片宽度 */
    @media (max-width: 1200px) {
        .viewer-pill {
            font-size: 10.5px !important;
            padding: 3px 7px !important;
            gap: 3px;
        }

        .viewer-pill .viewer-icon {
            font-size: 11px;
        }

        .live-duration {
            font-size: 10.5px !important;
            padding: 3px 6px !important;
        }
    }

    /* 极窄卡片 - 底栏元素堆叠 */
    @media (max-width: 900px) {
        .card-bottom-bar {
            flex-direction: column;
            align-items: flex-start;
            gap: 6px;
            height: auto;
        }

        .viewer-pill,
        .live-duration {
            font-size: 11px !important;
        }
    }
}

/* ========================================
   【窄窗口桌面】优化 - 防止按钮溢出隐藏
   ======================================== */
@media (min-width: 768px) and (max-width: 1024px) {
    /* 当按钮换行后仍然溢出，启用横向滚动 */
    header > div:last-child {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
    }

    header > div:last-child::-webkit-scrollbar {
        height: 4px;
    }

    header > div:last-child::-webkit-scrollbar-track {
        background: transparent;
    }

    header > div:last-child::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 2px;
    }
}

/* ========================================
   【大屏优化】4K及以上分辨率 - 舒适布局
   ======================================== */
@media (min-width: 2560px) {
    .monitor-grid {
        grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
        gap: 1.5rem;
    }

    .room-title {
        font-size: 18px;
    }

    .room-owner {
        font-size: 14px;
    }

    header h1 {
        font-size: 2.5rem;
    }
}

/* ========================================
   【纵向屏幕优化】竖屏优先
   ======================================== */
@media (orientation: portrait) {
    header {
        flex-direction: column;
        gap: 0.5rem;
    }
}

/* ========================================
   【横向屏幕优化】横屏优先
   ======================================== */
@media (orientation: landscape) {
    body {
        padding-top: 0.5rem !important;
        padding-bottom: 0.5rem !important;
    }

    header {
        margin-bottom: 1rem !important;
    }

    .zone-container {
        margin-bottom: 2rem;
    }
}

/* ========================================
   【低光环境优化】深色模式偏好
   ======================================== */
@media (prefers-color-scheme: dark) {
    body {
        background-color: #050505;
        color: #e5e7eb;
    }

    /* 进一步降低对比度缓解眼睛疲劳 */
    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
}

/* ========================================
   【减少动画】无障碍支持
   ======================================== */
@media (prefers-reduced-motion: reduce) {
    * {
        animation: none !important;
        transition: none !important;
    }

    #snow-canvas {
        display: none !important;
    }
}

/* ========================================
   【高对比度】无障碍支持
   ======================================== */
@media (prefers-contrast: more) {
    body {
        color: #ffffff;
    }

    .room-title {
        font-weight: 900;
    }

    .zone-title {
        text-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
    }
}

/* ========================================
   【触摸设备优化】指针设备检测
   ======================================== */
@media (hover: none) and (pointer: coarse) {
    /* 移动设备 */
    button:hover,
    .action-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .room-card:hover {
        transform: none;
    }

    .card-actions {
        opacity: 1 !important;
    }
}

@media (hover: hover) and (pointer: fine) {
    /* 鼠标设备 */
    button:hover,
    .action-btn:hover {
        background: white;
        color: black;
    }

    .room-card:hover {
        transform: translateY(-8px) scale(1.02);
    }

    .card-actions {
        opacity: 0;
    }

    .room-card:hover .card-actions {
        opacity: 1;
    }
}

/* ========================================
   【网络条件优化】低带宽
   ======================================== */
@media (prefers-reduced-data: reduce) {
    /* 禁用雪花特效 */
    #snow-canvas {
        display: none !important;
    }

    /* 禁用渐变 */
    * {
        background-image: none !important;
    }

    /* 禁用阴影 */
    body {
        box-shadow: none !important;
    }

    .room-card {
        box-shadow: none !important;
        border: 1px solid #333;
    }
}
